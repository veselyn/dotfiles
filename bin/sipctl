#!/usr/bin/env bash

set -euo pipefail

function main() {
	local command=$1

	case "$command" in
	disable)
		csrutil enable --without fs --without debug --without nvram
		nvram boot-args=-arm64e_preview_abi
		;;
	enable)
		csrutil enable
		nvram -d boot-args
		;;
	status)
		csrutil status
		set +e
		nvram boot-args
		set -e
		;;
	*)
		echo >&2 'unknown command'
		return 1
		;;
	esac
}

if [[ "${BASH_SOURCE[0]}" == "$0" ]]; then
	main "$@"
fi
